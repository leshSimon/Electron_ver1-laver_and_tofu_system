CREATE SCHEMA lavertu ;

CREATE TABLE lavertu.product (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  date DATETIME NOT NULL,
  goodsId MEDIUMINT UNSIGNED NOT NULL,
  Inventory INT UNSIGNED NOT NULL,
  output INT UNSIGNED NOT NULL,
  PRIMARY KEY (id));

CREATE TABLE lavertu.goods (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  release_date DATE NOT NULL,
  discarded_date DATE NULL,
  name VARCHAR(45) NULL,
  business_unit MEDIUMINT UNSIGNED NOT NULL,
  unit_price INT UNSIGNED NOT NULL,
  PRIMARY KEY (id));

CREATE TABLE lavertu.unit_price (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  goodsId INT UNSIGNED NOT NULL,
  price INT UNSIGNED NOT NULL,
  PRIMARY KEY (id));

ALTER TABLE lavertu.goods 
CHANGE COLUMN business_unit business_unit_Id MEDIUMINT UNSIGNED NOT NULL ,
CHANGE COLUMN unit_price unit_price_Id INT UNSIGNED NOT NULL ,
ADD INDEX unit_price_idx (unit_price_Id ASC) VISIBLE;
;
ALTER TABLE lavertu.goods 
ADD CONSTRAINT unit_price
  FOREIGN KEY (unit_price_Id)
  REFERENCES lavertu.unit_price (id)
  ON DELETE NO ACTION
  ON UPDATE CASCADE;

CREATE TABLE lavertu.business_unit (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  start_date DATE NOT NULL,
  end_date DATE NULL,
  name VARCHAR(45) NOT NULL,
  PRIMARY KEY (id));

CREATE TABLE lavertu.selling (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  date DATE NOT NULL,
  goods_id INT UNSIGNED NOT NULL,
  consumer VARCHAR(60) NOT NULL,
  quantity INT UNSIGNED NOT NULL,
  supply_price INT UNSIGNED NOT NULL,
  payment_date DATETIME NULL,
  payment_method_id MEDIUMINT UNSIGNED NOT NULL,
  remark VARCHAR(200) NULL,
  PRIMARY KEY (id),
  INDEX goods_idx (goods_id ASC) VISIBLE,
  CONSTRAINT goods
    FOREIGN KEY (goods_id)
    REFERENCES lavertu.goods (id)
    ON DELETE NO ACTION
    ON UPDATE CASCADE);

CREATE TABLE lavertu.payment_method (
  id MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(45) NOT NULL,
  PRIMARY KEY (id));

ALTER TABLE lavertu.selling 
ADD INDEX payment_method_idx (payment_method_id ASC) VISIBLE;
;
ALTER TABLE lavertu.selling 
ADD CONSTRAINT payment_method
  FOREIGN KEY (payment_method_id)
  REFERENCES lavertu.payment_method (id)
  ON DELETE NO ACTION
  ON UPDATE CASCADE;

CREATE TABLE lavertu.material (
  id MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(70) NOT NULL,
  unit VARCHAR(45) NOT NULL,
  business_unit_id MEDIUMINT UNSIGNED NOT NULL,
  PRIMARY KEY (id));

CREATE TABLE lavertu.material_input_and_output (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  date DATE NOT NULL,
  material_id MEDIUMINT UNSIGNED NOT NULL,
  inventory INT UNSIGNED NOT NULL DEFAULT 0,
  add INT UNSIGNED NOT NULL DEFAULT 0,
  PRIMARY KEY (id),
  INDEX material_kinds_idx (material_id ASC) VISIBLE,
  CONSTRAINT material_kinds
    FOREIGN KEY (material_id)
    REFERENCES lavertu.material (id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

ALTER TABLE lavertu.business_unit 
CHANGE COLUMN id id MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT ;

ALTER TABLE lavertu.goods 
ADD INDEX business_unit_idx (business_unit_Id ASC) VISIBLE;
;
ALTER TABLE lavertu.goods 
ADD CONSTRAINT business_unit
  FOREIGN KEY (business_unit_Id)
  REFERENCES lavertu.business_unit (id)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE lavertu.material 
ADD INDEX business_unit_for_material_idx (business_unit_id ASC) VISIBLE;
;
ALTER TABLE lavertu.material 
ADD CONSTRAINT business_unit_for_material
  FOREIGN KEY (business_unit_id)
  REFERENCES lavertu.business_unit (id)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE lavertu.product 
CHANGE COLUMN goodsId goods_id INT UNSIGNED NOT NULL ,
ADD INDEX goods_for_product_idx (goods_id ASC) VISIBLE;
;
ALTER TABLE lavertu.product 
ADD CONSTRAINT goods_for_product
  FOREIGN KEY (goods_id)
  REFERENCES lavertu.goods (id)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

